<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vladimir Dietrich's Blog</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Charter, 'Bitstream Charter', 'Sitka Text', Cambria, serif;
      line-height: 1.58;
      color: rgba(41, 41, 41, 1);
      background-color: #fff;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Header */
    .header {
      border-bottom: 1px solid rgba(230, 230, 230, 1);
      padding: 25px 0;
      background: #fff;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(20px);
      background-color: rgba(255, 255, 255, 0.95);
    }

    .header-content {
      max-width: 1192px;
      margin: 0 auto;
      padding: 0 64px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 32px;
      font-weight: 700;
      color: rgba(41, 41, 41, 1);
      text-decoration: none;
      letter-spacing: -0.003em;
    }

    .nav-links {
      display: flex;
      gap: 32px;
    }

    .nav-links a {
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: rgba(117, 117, 117, 1);
      text-decoration: none;
      font-weight: 400;
      font-size: 16px;
      transition: color 0.15s ease;
    }

    .nav-links a:hover {
      color: rgba(41, 41, 41, 1);
    }

    /* Main Container */
    .container {
      max-width: 728px;
      margin: 0 auto;
      padding: 0 24px;
    }

    /* Loading state */
    .loading {
      text-align: center;
      padding: 80px 0;
      color: rgba(117, 117, 117, 1);
      font-size: 18px;
    }

    /* Article List */
    .article-list {
      padding: 48px 0;
    }

    .article-item {
      border-bottom: 1px solid rgba(242, 242, 242, 1);
      padding: 32px 0;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .article-item:hover {
      transform: translateY(-1px);
    }

    .article-item:last-child {
      border-bottom: none;
    }

    .article-date {
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: rgba(117, 117, 117, 1);
      font-size: 13px;
      margin-bottom: 8px;
      font-weight: 400;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .article-title {
      font-size: 22px;
      font-weight: 700;
      line-height: 1.22;
      margin-bottom: 8px;
      color: rgba(41, 41, 41, 1);
      letter-spacing: -0.012em;
    }

    .article-preview {
      color: rgba(117, 117, 117, 1);
      font-size: 16px;
      line-height: 1.4;
      margin-bottom: 12px;
    }

    .article-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: rgba(117, 117, 117, 1);
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .author-name {
      font-weight: 400;
      color: rgba(41, 41, 41, 1);
    }

    .reading-time {
      color: rgba(117, 117, 117, 1);
    }

    /* Individual Article View */
    .article-view {
      display: none;
    }

    /* Hero Image */
    .hero-image-container {
      width: 100vw;
      position: relative;
      left: 50%;
      right: 50%;
      margin-left: -50vw;
      margin-right: -50vw;
      margin-bottom: 48px;
      height: 400px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f8f9fa;
    }

    .hero-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }

    .hero-caption {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
      color: white;
      padding: 32px 24px 16px;
      font-size: 14px;
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      text-align: center;
    }

    .article-content-wrapper {
      padding: 56px 0;
    }

    .back-button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: rgba(26, 137, 23, 1);
      text-decoration: none;
      margin-bottom: 32px;
      font-size: 14px;
      font-weight: 400;
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      transition: color 0.15s ease;
    }

    .back-button:hover {
      color: rgba(21, 117, 19, 1);
    }

    .article-header {
      margin-bottom: 48px;
      text-align: left;
    }

    .article-header h1 {
      font-size: 42px;
      font-weight: 700;
      line-height: 1.04;
      margin-bottom: 24px;
      color: rgba(41, 41, 41, 1);
      letter-spacing: -0.015em;
    }

    .article-header .meta {
      color: rgba(117, 117, 117, 1);
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .article-content {
      font-size: 21px;
      line-height: 1.58;
      color: rgba(41, 41, 41, 1);
      letter-spacing: -0.003em;
    }

    .article-content h1,
    .article-content h2,
    .article-content h3 {
      margin: 48px 0 16px 0;
      color: rgba(41, 41, 41, 1);
      font-weight: 700;
      letter-spacing: -0.022em;
      line-height: 1.15;
    }

    .article-content h1 {
      font-size: 34px;
      margin-top: 56px;
    }

    .article-content h2 {
      font-size: 28px;
      margin-top: 48px;
    }

    .article-content h3 {
      font-size: 24px;
      margin-top: 40px;
    }

    .article-content p {
      margin-bottom: 32px;
      word-break: break-word;
    }

    /* Image with caption styling */
    .article-content figure {
      margin: 40px 0;
      text-align: center;
    }

    .article-content figure img {
      max-width: 100%;
      height: auto;
      border-radius: 6px;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.06);
      display: block;
      margin: 0 auto;
    }

    .article-content figcaption {
      margin-top: 12px;
      font-size: 14px;
      line-height: 1.4;
      color: rgba(117, 117, 117, 1);
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      text-align: center;
      font-style: italic;
    }

    /* Legacy image support (images without figure wrapper) */
    .article-content img:not(figure img) {
      max-width: 100%;
      height: auto;
      margin: 40px 0;
      border-radius: 6px;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.06);
      display: block;
    }

    .article-content strong {
      font-weight: 700;
      color: rgba(41, 41, 41, 1);
    }

    .article-content em {
      font-style: italic;
    }

    .article-content blockquote {
      border-left: 3px solid rgba(41, 41, 41, 1);
      padding-left: 23px;
      margin: 32px 0;
      font-style: italic;
      color: rgba(117, 117, 117, 1);
      font-size: 21px;
      line-height: 1.58;
    }

    .article-content code {
      background-color: rgba(242, 242, 242, 1);
      padding: 2px 4px;
      border-radius: 3px;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      font-size: 16px;
      color: rgba(41, 41, 41, 1);
    }

    .article-content pre {
      background-color: rgba(242, 242, 242, 1);
      padding: 20px;
      border-radius: 6px;
      overflow-x: auto;
      margin: 24px 0;
    }

    .article-content pre code {
      background: none;
      padding: 0;
      font-size: 14px;
    }

    /* Footer */
    .footer {
      border-top: 1px solid rgba(242, 242, 242, 1);
      padding: 48px 0;
      margin-top: 96px;
      text-align: center;
      color: rgba(117, 117, 117, 1);
      font-size: 14px;
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header-content {
        padding: 0 24px;
      }

      .container {
        padding: 0 20px;
      }

      .logo {
        font-size: 28px;
      }

      .nav-links {
        gap: 24px;
      }

      .article-title {
        font-size: 20px;
      }

      .hero-image-container {
        height: 250px;
      }

      .article-header h1 {
        font-size: 32px;
        line-height: 1.1;
      }

      .article-content {
        font-size: 19px;
      }

      .article-content h1 {
        font-size: 28px;
      }

      .article-content h2 {
        font-size: 24px;
      }

      .article-content h3 {
        font-size: 21px;
      }
    }

    @media (max-width: 480px) {
      .header-content {
        padding: 0 16px;
      }

      .container {
        padding: 0 16px;
      }

      .hero-image-container {
        height: 200px;
      }

      .article-header h1 {
        font-size: 28px;
      }

      .article-content {
        font-size: 18px;
      }
    }

    /* Error state */
    .error {
      text-align: center;
      padding: 80px 0;
      color: rgba(117, 117, 117, 1);
    }

    .error h2 {
      color: rgba(41, 41, 41, 1);
      margin-bottom: 16px;
      font-size: 24px;
      font-weight: 700;
    }

    /* Selection styling */
    ::selection {
      background-color: rgba(26, 137, 23, 0.1);
    }

    ::-moz-selection {
      background-color: rgba(26, 137, 23, 0.1);
    }
  </style>
</head>

<body>
  <header class="header">
    <div class="header-content">
      <a href="#" class="logo" onclick="showHome()">Vladimir Dietrich</a>
      <nav class="nav-links">
        <a href="#" onclick="showHome()">Blog</a>
        <a href="https://vladi.dev" target="_blank">Portfolio</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Loading State -->
    <div id="loading" class="loading">
      <p>Loading articles...</p>
    </div>

    <!-- Error State -->
    <div id="error" class="error" style="display: none;">
      <h2>Unable to load articles</h2>
      <p>Please check the configuration and try again.</p>
    </div>

    <!-- Article List -->
    <div id="article-list" class="article-list" style="display: none;">
      <!-- Articles will be populated here -->
    </div>

    <!-- Individual Article View -->
    <div id="article-view" class="article-view">
      <div id="hero-section">
        <!-- Hero image will be inserted here -->
      </div>
      <div class="article-content-wrapper">
        <a href="#" class="back-button" onclick="showHome()">
          ← Back to all articles
        </a>
        <div id="article-content">
          <!-- Individual article content will be populated here -->
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2025 Vladimir Dietrich. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // Configuration - No configuration needed, data comes from same repository
    let articles = [];
    let currentView = 'home';

    // Initialize the blog
    document.addEventListener('DOMContentLoaded', function () {
      loadArticles();

      // Handle browser back/forward
      window.addEventListener('popstate', function (event) {
        if (event.state) {
          if (event.state.view === 'home') {
            showHome(false);
          } else if (event.state.view === 'article') {
            showArticle(event.state.articleId, false);
          }
        }
      });
    });

    async function loadArticles() {
      try {
        showLoading();

        // Load from the same repository's data folder
        const response = await fetch('./data/articles.json');

        if (!response.ok) {
          throw new Error('Failed to load articles index');
        }

        const data = await response.json();
        articles = data.articles || [];

        displayArticleList();

      } catch (error) {
        console.error('Error loading articles:', error);
        showError();
      }
    }

    function displayArticleList() {
      const listContainer = document.getElementById('article-list');

      if (articles.length === 0) {
        listContainer.innerHTML = '<div class="error"><h2>No articles found</h2><p>No articles have been published yet.</p></div>';
        showElement('article-list');
        return;
      }

      const articlesHtml = articles.map(article => {
        const date = new Date(article.date).toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        });

        // Format reading time
        const readingTime = article.readingTime ?
          `${article.readingTime} min read` : '';

        return `
                    <div class="article-item" onclick="showArticle('${article.id}')">
                        <div class="article-date">${date}</div>
                        <h2 class="article-title">${escapeHtml(article.title)}</h2>
                        <div class="article-meta">
                            <span class="author-name">${escapeHtml(article.author)}</span>
                            ${readingTime ? `<span>·</span><span class="reading-time">${readingTime}</span>` : ''}
                        </div>
                    </div>
                `;
      }).join('');

      listContainer.innerHTML = articlesHtml;
      showElement('article-list');
    }

    async function showArticle(articleId, pushState = true) {
      try {
        showLoading();

        // Load from the same repository's data folder
        const response = await fetch(`./data/${articleId}.json`);

        if (!response.ok) {
          throw new Error('Failed to load article');
        }

        const article = await response.json();
        displayArticle(article);

        if (pushState) {
          history.pushState(
            { view: 'article', articleId: articleId },
            article.title,
            `#${articleId}`
          );
        }

        currentView = 'article';

      } catch (error) {
        console.error('Error loading article:', error);
        showError();
      }
    }

    function displayArticle(article) {
      const date = new Date(article.date).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });

      // Format reading time
      const readingTime = article.readingTime ?
        `${article.readingTime} min read` : '';

      // Handle hero image
      let heroImageHtml = '';
      if (article.heroImage && article.heroImage.githubUrl) {
        const caption = article.heroImage.caption ?
          `<div class="hero-caption">${escapeHtml(article.heroImage.caption)}</div>` : '';

        heroImageHtml = `
          <div class="hero-image-container">
            <img src="${article.heroImage.githubUrl}" 
                 alt="${escapeHtml(article.heroImage.altText || '')}" 
                 class="hero-image">
            ${caption}
          </div>
        `;
      }

      // Process content to add captions to images
      let processedContent = article.content;

      // Find images in the content and add captions if available
      if (article.images && article.images.length > 0) {
        article.images.forEach(image => {
          if (image.caption) {
            // Replace figure tags that contain this image with caption
            const imageUrlPattern = escapeRegExp(image.githubUrl);
            const figureRegex = new RegExp(
              `<figure><img\\s+src="${imageUrlPattern}"([^>]*)\\s*/?></figure>`,
              'gi'
            );

            processedContent = processedContent.replace(figureRegex,
              `<figure><img src="${image.githubUrl}"$1><figcaption>${escapeHtml(image.caption)}</figcaption></figure>`
            );

            // Handle images not wrapped in figure tags AND not already having captions
            const imgRegex = new RegExp(
              `<img\\s+src="${imageUrlPattern}"([^>]*)\\s*/?>(?!<\/figure>)(?!.*<figcaption>)`,
              'gi'
            );

            processedContent = processedContent.replace(imgRegex,
              `<figure><img src="${image.githubUrl}"$1><figcaption>${escapeHtml(image.caption)}</figcaption></figure>`
            );
          }
        });
      }

      const articleHtml = `
                <div class="article-header">
                    <h1>${escapeHtml(article.title)}</h1>
                    <div class="meta">
                        <span class="author-name">${escapeHtml(article.author)}</span>
                        <span>·</span>
                        <span>${date}</span>
                        ${readingTime ? `<span>·</span><span class="reading-time">${readingTime}</span>` : ''}
                    </div>
                </div>
                <div class="article-content">
                    ${processedContent}
                </div>
            `;

      // Insert hero image
      document.getElementById('hero-section').innerHTML = heroImageHtml;

      // Insert article content
      document.getElementById('article-content').innerHTML = articleHtml;

      showElement('article-view');

      // Update page title
      document.title = `${article.title} - Vladimir Dietrich's Blog`;

      // Scroll to top
      window.scrollTo(0, 0);
    }

    function showHome(pushState = true) {
      showElement('article-list');

      if (pushState) {
        history.pushState({ view: 'home' }, 'Blog', '/');
      }

      currentView = 'home';

      // Update page title
      document.title = "Vladimir Dietrich's Blog";
    }

    function showLoading() {
      hideAllViews();
      document.getElementById('loading').style.display = 'block';
    }

    function showError() {
      hideAllViews();
      document.getElementById('error').style.display = 'block';
    }

    function showElement(elementId) {
      hideAllViews();
      document.getElementById(elementId).style.display = 'block';
    }

    function hideAllViews() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'none';
      document.getElementById('article-list').style.display = 'none';
      document.getElementById('article-view').style.display = 'none';
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // Handle initial URL
    window.addEventListener('load', function () {
      const hash = window.location.hash.slice(1);
      if (hash && articles.length > 0) {
        const article = articles.find(a => a.id === hash);
        if (article) {
          showArticle(hash, false);
        }
      }
    });
  </script>
</body>

</html>